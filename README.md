# Super Watarec

Appleシリコン最適化の動画編集GUIアプリケーション

## 概要

Super Watarec（スーパーワタレック）は、Electron + FFmpegベースのAppleシリコン（M1/M2/M3）向け最適化済みの直感的な動画編集アプリケーションです。

主な機能：
- タイムラインベースの直感的なクリップ操作
- 音声波形による高精度なトリミング
- ラウドネス正規化（-14 LUFS）
- 音声のクロスフェード結合
- ハードウェア支援による高速書き出し
- 最終的に全ての動画を一つの動画に書き出し
- 書き出し対応フォーマット：H.264 / H.265 / ProRes HQ

## UIポリシー

本プロジェクトでは、以下のUIポリシーに従って開発を行います：

- **Material-UI (MUI) の使用**: すべてのUIコンポーネントはMUIを使用して実装します
- **一貫性のあるデザイン**: 同じ機能には同じコンポーネントを使用し、一貫性を保ちます
- **テーマの統一**: MUIのThemeProviderを使用してアプリ全体でテーマを統一します
- **デフォルトのHTMLタグ禁止**: 直接のdiv, span, h1などの使用を避け、代わりにBox, Typography等を使用します
- **レスポンシブデザイン**: MUIのGridシステムを活用し、様々な画面サイズに対応します
- **アクセシビリティ**: WAI-ARIAガイドラインに準拠したコンポーネントを使用します

### MUIコンポーネントマッピング

| 従来の要素 | MUIコンポーネント |
|------------|------------------|
| div (container) | Box, Container, Paper |
| h1, h2, h3, ... | Typography variant="h1" - "h6" |
| button | Button, IconButton |
| input | TextField, Input |
| select | Select, MenuItem |
| span | Typography variant="body2", "caption" |

## UI構成

アプリは4つの主要エリアで構成されています：
1. **素材リスト**: 複数動画リストでタイムライン部分
2. **プレビュー**: 動画再生プレイヤー部分
3. **タイムライン**: 動画操作部分
4. **トリミング**: 動画トリミング部分

## インストール方法

### 開発環境のセットアップ

```bash
# 依存関係のインストール
npm install

# 開発モードで起動
npm run dev

# ビルド
npm run build
```

## 使い方

1. **素材の追加**：「ファイル追加」または「フォルダ追加」ボタンから素材を追加します。
2. **波形表示と編集**：動画を選択すると波形が表示され、IN点/OUT点を設定できます。
3. **タイムライン編集**：トリムしたクリップをタイムラインに配置し、順序を編集します。
4. **書き出し**：解像度、フレームレート、コーデックを選択して書き出します。

## 技術スタック

- **UI**: Electron + HTML/CSS/JavaScript
- **動画処理**: FFmpeg
- **エンコード**: VideoToolbox（HW支援） + ProRes
- **波形描画**: PCM（s16le） → Int16Array → Canvas
- **タスク管理**: Node.js非同期 + フロント同期通知

## 実装ポリシー

### 作業ディレクトリポリシー

アプリケーションの作業ディレクトリ管理には、以下のポリシーを適用します：

- **統一された作業ディレクトリ**: ユーザーのホームディレクトリに `Super Watarec` フォルダを作成し、すべての作業ディレクトリはその配下に作成します
- **共通ストレージサービスの利用**: ディレクトリ作成・管理は `storageService.ensureWorkDirectories` メソッドを使用して一元管理します
- **サブディレクトリ構造**:
  - `~/Super Watarec/export`: 動画書き出し用の一時ファイルと出力ファイル
  - `~/Super Watarec/waveform`: 波形データ生成・保存用
  - `~/Super Watarec/thumbnails`: サムネイル画像生成・保存用
- **タスク固有の一時ディレクトリ**: 各タスクは固有のIDを持つサブディレクトリを使用し、タスク完了後に自動削除します
- **ファイルパス管理**: すべてのパスは絶対パスとして管理し、相対パスの使用は避けます

この方針により、ファイル管理の一貫性を確保し、複数のタスクが同時に実行されても安全に処理できます。

### IPC通信ポリシー

Electron環境におけるプロセス間通信（IPC）には、以下のポリシーを適用します：

- **バイナリデータの直接送信禁止**: IPCチャネルでは、バイナリデータの直接送信を行わず、基本的にStringベースの通信のみを行います
- **ファイルパス参照方式**: 大きなデータや複雑なデータ構造は、ファイルに保存し、そのファイルパスを参照する方式を採用します
- **各プロセスでのファイル処理**: メインプロセスとレンダラープロセスは、それぞれ必要に応じてファイルを開いて適切に処理します
- **JSON形式の使用**: メッセージの構造化には常にJSON形式を使用し、型安全性を確保します
- **エラーハンドリング**: すべてのIPC通信には適切なエラーハンドリングを実装します

この方針により、大きなデータの処理効率が向上し、メモリ使用量の最適化と安定性の向上を図ります。

## 開発ロードマップ

- ✅ **フェーズ1**: 基盤構築
  - Electron環境セットアップ
  - FFmpeg連携確認
  - 基本UI実装

- ✅ **フェーズ2**: 編集機能
  - トリミング機能
  - 音声波形表示
  - タイムライン操作

- ✅ **フェーズ3**: 処理機能
  - ラウドネス正規化
  - 書き出し設定
  - 結合処理

- ✅ **フェーズ4**: UI/UX強化
  - バックグラウンド処理表示
  - 処理状況の可視化
  - エラー処理の改善

## ライセンス

MIT

## 注意事項

- 本アプリケーションはAppleシリコンのハードウェアアクセラレーションを活用するため、Intel Macでは一部機能の性能が低下する可能性があります。
- フェーズ1の実装が完了した段階で、基本的な機能のみ実装されています。 